varbook
}
RRandRCI_var.lt <- read_xlsx("/Users/hsuwei/Google Drive/Research/Git/the children/variable/rci2011.xlsx",
col_names = F) %>%
clean_codebookrci11(.) %>%
list(varrci2011 = .) %>%
c(RRandRCI_var.lt, .)
View(RRandRCI_var.lt)
source("/Users/hsuwei/Google Drive/Research/git2/the children/RRandRCI_codebook.R")
View(clean_codebook0708)
save(RRandRCI_var.lt, file = "/Users/hsuwei/Google Drive/Research/git2/the children/RRandRCI_codebook.RData")
source("/Users/hsuwei/Google Drive/Research/git2/the children/RRandRCI_codebook.RData")
load("/Users/hsuwei/Google Drive/Research/git2/the children/RRandRCI_codebook.RData")
View(RRandRCI_var.lt)
library(tidyverse)
mtable <- "mtable18"
download_fn <- function(year, mtable) { ## 資料年份(民國), 資料表格號碼
temp = tempfile(fileext = ".xls")
dataURL <- str_c("https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility",
year, str_c(mtable, ".xls"), sep = "/")
download.file(dataURL, destfile = temp, mode = 'wb')
if (year < 104) {
df <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
} else {
df <- readxl::read_excel(temp, col_names = F, range = "K9:R54") %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
}
return(df)
}
y_range <- 2011 : 2017 - 1911
mtable <- ifelse(y_range == 100, "mtable18", "mtable17")
all.lt <- map2(y_range, mtable, download_fn)
names(all.lt) <- str_c(2011:2017, "major_job")
all.lt$`2011major_job`
download_fn <- function(year, mtable) { ## 資料年份(民國), 資料表格號碼
temp = tempfile(fileext = ".xls")
dataURL <- str_c("https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility",
year, str_c(mtable, ".xls"), sep = "/")
download.file(dataURL, destfile = temp, mode = 'wb')
if (year < 104) {
df1 <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
} else {
df1 <- readxl::read_excel(temp, col_names = F, range = "K9:R54")
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
}
return(df2)
}
y_range <- 2011 : 2017 - 1911
mtable <- ifelse(y_range == 100, "mtable18", "mtable17")
all.lt <- map2(y_range, mtable, download_fn)
names(all.lt) <- str_c(2011:2017, "major_job")
all.lt$`2011major_job`
aa <- all.lt$`2011major_job`
View(aa)
aa <- all.lt$`2015major_job`
View(aa)
map(all.lt, function(x)
select(x, 1, 2 , 3))
map(all.lt, function(x)
select(x, c(1, 2 , 3)))
select(aa, 1,2,3)
map(all.lt, ~ df %>%
select(1, 2, 3))
pluck(all.lt, 1)
x
}
map(all.lt, function(x) {
xx <- select(x, 1, 2,3)
x
})
xx <- select(x, Item)
map(all.lt, function(x) {
xx <- select(x, Item)
x
})
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n)
return(out.df)
}
pickvar(aa, c(1:3))
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n) %>%
slice(1, 2) ## keep total, 15-24
return(out.df)
}
xx <- map(all.lt, pickvar, 1:3)
pickvar(aa, 1:3)
out.df <- df %>%
select(col_n)
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n)
return(out.df)
}
pickvar(aa, 1:3)
pickvar(aa, 1:3) %>%
slice(1, 2) ## keep total, 15-24
pickvar(aa, 1:3) %>%
slice(1:2) ## keep total, 15-24
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n)
return(out.df)
}
pickvar(aa, 1:3)
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n) %>%
slice(1:2) ## keep total, 15-24
return(out.df)
}
pickvar(aa, 1:3)
xx <- map(all.lt, pickvar, 1:3)
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n) %>%
slice(1:2) ## keep total, 15-24
return(out.df)
}
xx <- map2(all.lt,  1:3 pickvar)
xx <- map2(all.lt,  1:3, pickvar)
xx <- map2(all.lt, 1:3, pickvar)
xx <- map(all.lt, 1:3, pickvar)
xx <- map(all.lt, pickvar,  1:3)
pickvar(all.lt$`2012major_job`, 1:3)
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n) %>%
slice(1:2) ## keep total, 15-24
return(out.df)
}
pickvar(all.lt$`2012major_job`, 1:3)
(all.lt$`2012major_job`
all.lt$`2012major_job
all.lt$`2014major_job`
download_fn <- function(year, mtable) { ## 資料年份(民國), 資料表格號碼
temp = tempfile(fileext = ".xls")
dataURL <- str_c("https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility",
year, str_c(mtable, ".xls"), sep = "/")
download.file(dataURL, destfile = temp, mode = 'wb')
if (year < 104) {
df1 <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
} else {
df1 <- readxl::read_excel(temp, col_names = F, range = "K9:R54")
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
}
return(df2)
}
y_range <- 2011 : 2017 - 1911
mtable <- ifelse(y_range == 100, "mtable18", "mtable17")
## 表 17 就業者主要工作之類別－按年齡分，有年份差異
all.lt <- map2(y_range, mtable, download_fn)
names(all.lt) <- str_c(2011:2017, "major_job")
all.lt
dataURL <- "https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility/104/mtable17.xls"
download.file(dataURL, destfile=temp, mode='wb')
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
temp = tempfile(fileext = ".xls")
dataURL <- "https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility/104/mtable17.xls"
download.file(dataURL, destfile=temp, mode='wb')
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) #%>%
View(test)
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric)
View(test)
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) #%>%
View(test)
temp = tempfile(fileext = ".xls")
dataURL <- "https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility/105/mtable17.xls"
download.file(dataURL, destfile=temp, mode='wb')
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) #%>%
View(test)
dataURL <- "https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility/106/mtable17.xls"
download.file(dataURL, destfile=temp, mode='wb')
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) #%>%
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) %>%
slice(c(2, 3, 6, 11, 16)) #%>%
y_range <- 2011 : 2017 - 1911
mtable <- ifelse(y_range == 100, "mtable18", "mtable17")
## 表 17 就業者主要工作之類別－按年齡分，有年份差異
all.lt <- map2(y_range, mtable, download_fn)
names(all.lt) <- str_c(2011:2017, "major_job")
all.lt
temp = tempfile(fileext = ".xls")
dataURL <- "https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility/101/mtable17.xls"
download.file(dataURL, destfile=temp, mode='wb')
temp = tempfile(fileext = ".xls")
dataURL <- "https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility/101/mtable18.xls"
download.file(dataURL, destfile=temp, mode='wb')
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54") #%>%
View(test)
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) #%>%
temp = tempfile(fileext = ".xls")
dataURL <- "https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility/101/mtable18.xls"
download.file(dataURL, destfile=temp, mode='wb')
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) %>%
slice(c(2, 3, 6, 11, 16)) #%>%
test <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text")) %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric)
year <- "101"
mtable <- "mtable18"
temp = tempfile(fileext = ".xls")
dataURL <- str_c("https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility",
year, str_c(mtable, ".xls"), sep = "/")
download.file(dataURL, destfile = temp, mode = 'wb')
if (year < 104) {
df1 <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
} else {
df1 <- readxl::read_excel(temp, col_names = F, range = "K9:R54")
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
}
View(df2)
download_fn <- function(year, mtable) { ## 資料年份(民國), 資料表格號碼
temp = tempfile(fileext = ".xls")
dataURL <- str_c("https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility",
year, str_c(mtable, ".xls"), sep = "/")
download.file(dataURL, destfile = temp, mode = 'wb')
if (year < 104) {
df1 <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
} else {
df1 <- readxl::read_excel(temp, col_names = F, range = "K9:R54")
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
}
return(df2)
}
y_range <- 2011 : 2017 - 1911
mtable <- ifelse(y_range < 104, "mtable18", "mtable17")
## 表 17 就業者主要工作之類別－按年齡分，有年份差異
all.lt <- map2(y_range, mtable, download_fn)
names(all.lt) <- str_c(2011:2017, "major_job")
all.lt
pickvar(all.lt$`2012major_job`, 1:3)
xx <- map(all.lt, pickvar,  1:3)
map(all.lt, function(x) {
xx <- select(x, 1)
x
})
xx <- select(x, 1, 2, 3)
map(all.lt, function(x) {
xx <- select(x, 1, 2, 3)
x
})
map_dfr(all.lt, function(x) {
xx <- select(x, 1, 2, 3) %>%
slice(1:2) ## keep total, 15-24
x
})
map_dfr(all.lt, function(x) {
xx <- select(x, 1, 2, 3) %>%
slice(1:2) ## keep total, 15-24
x
})
map_dfr(all.lt, function(x) {
xx <- select(x, 1, 2, 3) %>%
slice(1:2) ## keep total, 15-24
xx
})
xx <- select(x, 1, 2, 3)
map_dfr(all.lt, function(x) {
xx <- select(x, 1, 2, 3)
xx
})
map_df(all.lt, function(x) {
xx <- select(x, 1, 2, 3)
xx
})
map_df(all.lt, function(x) {
xx <- select(x, 1, 2, 3)
xx
})
map(all.lt, function(x) {
xx <- select(x, 1, 2, 3)
xx
})
map(all.lt, function(x) {
xx <- select(x, 1, 2, 3) %>%
slice(1:2) ## keep total, 15-24
xx
})
map_dfc(all.lt, function(x) {
xx <- select(x, 3) %>%
slice(1:2) ## keep total, 15-24
colnames(xx) <- x[[1]]
xx
})
x <- all.lt$`2013major_job`
View(x)
xx <- select(x, 3) %>%
slice(1:2) ## keep total, 15-24
View(xx)
x[[1]]
x[[1:2, 1]]
x[1:2, 1]
x[[1:2, 1]]
x[[1]]
x[[1]][1:2]
colnames(xx) <- x[[1]][1:2]
colnames(xx)
rownames(xx) <- x[[1]][1:2]
xx
map_dfc(all.lt, function(x) {
xx <- select(x, 3) %>%
slice(1:2) ## keep total, 15-24
rownames(xx) <- x[[1]][1:2]
xx
})
x2 <- map_dfc(all.lt, function(x) {
xx <- select(x, 3) %>%
slice(1:2) ## keep total, 15-24
rownames(xx) <- x[[1]][1:2]
xx
})
View(x2)
x2 <- map_dfc(all.lt, function(x) {
xx <- select(x, 3) %>%
slice(1:2) ## keep total, 15-24
rownames(xx) <- x[[1]][1:2]
xx
})
download_fn <- function(year, mtable) { ## 資料年份(民國), 資料表格號碼
temp = tempfile(fileext = ".xls")
dataURL <- str_c("https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility",
year, str_c(mtable, ".xls"), sep = "/")
download.file(dataURL, destfile = temp, mode = 'wb')
if (year < 104) {
df1 <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
} else {
df1 <- readxl::read_excel(temp, col_names = F, range = "K9:R54")
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
}
return(df2)
}
y_range <- 2011 : 2017 - 1911
mtable <- ifelse(y_range < 104, "mtable18", "mtable17")
## 表 17 就業者主要工作之類別－按年齡分，有年份差異
all.lt <- map2(y_range, mtable, download_fn)
names(all.lt) <- str_c(2011:2017, "major_job")
aa <- all.lt$`2015major_job`
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n) %>%
slice(1:2) ## keep total, 15-24
return(out.df)
}
pickvar(all.lt$`2012major_job`, 1:3)
x <- all.lt$`2013major_job`
xx <- map(all.lt, pickvar,  1:3)
x2 <- map_dfc(all.lt, function(x) {
xx <- select(x, 3) %>%
slice(1:2) ## keep total, 15-24
rownames(xx) <- x[[1]][1:2]
xx
})
colnames(x2) <- 2011:2017
rownames(x2) <- c("Total", "15-24 years")
View(aa)
P.df <- map_dfc(all.lt, function(x) {
xx <- select(x, 6) %>% #part time
slice(1:2) ## keep total, 15-24
xx
})
xx <- select(x, 7) %>% #part time
slice(1:2) ## keep total, 15-24
TD.df <- map_dfc(all.lt, function(x) {
xx <- select(x, 7) %>% #part time
slice(1:2) ## keep total, 15-24
xx
})
download_fn <- function(year, mtable) { ## 資料年份(民國), 資料表格號碼
temp = tempfile(fileext = ".xls")
dataURL <- str_c("https://www.dgbas.gov.tw/public/data/dgbas04/bc4/mpwutility",
year, str_c(mtable, ".xls"), sep = "/")
download.file(dataURL, destfile = temp, mode = 'wb')
if (year < 104) {
df1 <- readxl::read_excel(temp, col_names = F, range = "J9:Q54", col_types = c("text"))
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
} else {
df1 <- readxl::read_excel(temp, col_names = F, range = "K9:R54")
df2 <- df1 %>%
slice(c(2, 3, 6, 11, 16)) %>%
mutate_at(vars(X__2:X__8), as.numeric) %>%
mutate(X__1 = c("Total", "15-24 years", "25-44 years", "45-64 years", "65 years & over"))
names(df2) <- df1[1, ]
}
return(df2)
}
y_range <- 2011 : 2017 - 1911
mtable <- ifelse(y_range < 104, "mtable18", "mtable17")
## 表 17 就業者主要工作之類別－按年齡分，有年份差異
all.lt <- map2(y_range, mtable, download_fn)
names(all.lt) <- str_c(2011:2017, "major_job")
aa <- all.lt$`2015major_job`
pickvar <- function(df, col_n) {
out.df <- df %>%
select(col_n) %>%
slice(1:2) ## keep total, 15-24
return(out.df)
}
pickvar(all.lt$`2012major_job`, 1:3)
x <- all.lt$`2013major_job`
xx <- map(all.lt, pickvar,  1:3)
PTD.df <- map_dfc(all.lt, function(x) {
xx <- select(x, 3) %>%
slice(1:2) ## keep total, 15-24
xx
})
colnames(PTD.df) <- 2011:2017
rownames(PTD.df) <- c("Total", "15-24 years")
P.df <- map_dfc(all.lt, function(x) {
xx <- select(x, 6) %>% #part time
slice(1:2) ## keep total, 15-24
xx
})
colnames(P.df) <- 2011:2017
rownames(P.df) <- c("Total", "15-24 years")
TD.df <- map_dfc(all.lt, function(x) {
xx <- select(x, 7) %>% #part time
slice(1:2) ## keep total, 15-24
xx
})
colnames(TD.df) <- 2011:2017
rownames(TD.df) <- c("Total", "15-24 years")
View(TD.df)
bind_rows(PTD.df, P.df) %>%
bind_rows(TD.df)
xx <- bind_rows(PTD.df, P.df) %>%
bind_rows(TD.df)
View(xx)
rownames(xx) <- c("Total", "15-24 years")
rep(c("Total", "15-24 years"), 3)
rownames(xx) <- rep(c("Total", "15-24 years"), 3)
rownames(xx)
xx <- bind_rows(PTD.df, P.df) %>%
bind_rows(TD.df) %>%
mutate(rowname = c("Total", "15-24 years"))
xx <- bind_rows(PTD.df, P.df) %>%
bind_rows(TD.df) %>%
mutate(rowname = rep(c("Total", "15-24 years"), 3))
View(xx)
getwd()
setwd(/Users/hsuwei/Desktop/man)
setwd("/Users/hsuwei/Desktop/man")
getwd()
write_csv(out1, path = str_c(getwd(), "nonstandard.csv", collapse = "/"))
out1 <- bind_rows(PTD.df, P.df) %>%
bind_rows(TD.df) %>%
mutate(rowname = rep(c("Total", "15-24 years"), 3))
write_csv(out1, path = str_c(getwd(), "nonstandard.csv", collapse = "/"))
str_c(getwd(), "nonstandard.csv", collapse = "/")
str_c(getwd(), "nonstandard.csv", collapse = "/")
getwd()
str_c(getwd(), "nonstandard.csv", sep = "/")
write_csv(out1, path = str_c(getwd(), "result", "nonstandard.csv", sep = "/"))
