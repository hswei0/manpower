library(magrittr)
library(tidyverse)
isco_99to08 <- read_dta("/Users/hsuwei/Desktop/gitt/1999-2008_ISCO.dta") %>%
mutate_all(as.integer)
## merging
using2.df <- using.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("fa_longestocc" = "PSFDcode")) %>%
rename(fa_occ = isco88)
using2.df <- using2.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("mo_longestocc" = "PSFDcode")) %>%
rename(mo_occ = isco88)
iscotoegp <- readxl::read_excel("/Users/hsuwei/Desktop/gitt/isco88 to egp.xlsx",
skip = 1, col_names = F)
names(iscotoegp) <- iscotoegp[1,]
iscotoegp <- iscotoegp[-1, 1:3]
iscotoegp$isco88 <- as.numeric(iscotoegp$isco88)
using2.df <- using2.df %>%
left_join(iscotoegp, by = c("fa_occ" = "isco88")) %>%
rename(fa_EGP = EGP11) %>%
left_join(iscotoegp, by = c("mo_occ" = "isco88")) %>%
rename(mo_EGP = EGP11) %>%
mutate_at(c("fa_EGP", "mo_EGP"), funs(replace(., . == 999, NA)))
funModeling::freq(using2.df$fa_EGP)
funModeling::df_status(using2.df)
library(devtools)
install_git("https://github.com/pdparker/isco88conversion")
convert(c(1000,9000), type = "EGP")
install.packages("SocialPosition")
library(SocialPosition)
data(data_MCH2007)
str(data_MCH2007)
head(data_MCH2007)
table(data_MCH2007$iscoR,useNA="always")
data_MCH2007 <- recode_from_ISCO88_to_ISEI(
ISCO88=data_MCH2007$iscoR,
data=data_MCH2007)
names(data_MCH2007)
head(data_MCH2007)
table(data_MCH2007$ISEI,useNA="always")
recode_from_ISCO88_to_ISEI(ISCO88, using2.df)
recode_from_ISCO88_to_ISEI(fa_occ, using2.df)
recode_from_ISCO88_to_ISEI(using2.df$fa_occ, using2.df$fa_occ)
library(SocialPosition)
data(data_MCH2007)
str(data_MCH2007)
head(data_MCH2007)
table(data_MCH2007$iscoR,useNA="always")
data_MCH2007 <- recode_from_ISCO88_to_ISEI(
ISCO88=data_MCH2007$iscoR,
data=data_MCH2007)
names(data_MCH2007)
head(data_MCH2007)
table(data_MCH2007$ISEI,useNA="always")
recode_from_ISCO88_to_ISEI(ISCO88 = using2.df$fa_occ, data = using2.df)
aa <- recode_from_ISCO88_to_ISEI(ISCO88 = using2.df$fa_occ, data = using2.df)
View(aa)
load("~/Desktop/workplace/allrun.RData")
library(haven)
library(haven)
library(magrittr)
library(tidyverse)
isco_99to08 <- read_dta("/Users/hsuwei/Desktop/gitt/1999-2008_ISCO.dta") %>%
mutate_all(as.integer)
using2.df <- using.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("fa_longestocc" = "PSFDcode")) %>%
rename(fa_occ = isco88)
using2.df <- using.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("fa_longestocc" = "PSFDcode")) %>%
rename(fa_isco88 = isco88)
using2.df <- using2.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("mo_longestocc" = "PSFDcode")) %>%
rename(mo_isco88 = isco88)
using2.df %<>%
mutate(fa_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .$fa_occ, data = .),
mo_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .$mo_occ, data = .))
library(SocialPosition)
using2.df %<>%
mutate(fa_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .$fa_occ, data = .),
mo_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .$mo_occ, data = .))
using2.df %<>%
mutate(fa_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .["fa_occ"], data = .),
mo_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .["mo_occ"], data = .))
load("~/Desktop/workplace/allrun.RData")
## To ISCO88
library(haven)
library(magrittr)
library(tidyverse)
isco_99to08 <- read_dta("/Users/hsuwei/Desktop/gitt/1999-2008_ISCO.dta") %>%
mutate_all(as.integer)
## merging
using2.df <- using.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("fa_longestocc" = "PSFDcode")) %>%
rename(fa_isco88 = isco88)
using2.df <- using2.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("mo_longestocc" = "PSFDcode")) %>%
rename(mo_isco88 = isco88)
library(SocialPosition)
using2.df %<>%
mutate(fa_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .["fa_isco88"], data = .),
mo_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .["mo_isco88"], data = .))
aa <- using2.df %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .["fa_isco88"], data = .)
View(aa)
aa <- using2.df %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .["fa_longestocc"], data = .)
fa_isco88
aa <- using2.df %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .["fa_isco88"], data = .)
funModeling:: freq(aa$ISEI)
table(aa$ISEI)
isco_99to08 <- read_dta("/Users/hsuwei/Desktop/gitt/1999-2008_ISCO.dta") %>%
mutate_all(as.integer)
using2.df <- using.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("fa_longestocc" = "PSFDcode")) %>%
rename(fa_isco88 = isco88)
using2.df <- using2.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("mo_longestocc" = "PSFDcode")) %>%
rename(mo_isco88 = isco88)
aa <- using2.df %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .["fa_isco88"], data = .)
View(aa)
recode_from_ISCO88_to_ISEI(using2.df$fa_isco88, using2.df)
aa <- recode_from_ISCO88_to_ISEI(using2.df$fa_isco88, using2.df)
View(aa)
using2.df %>%
.["fa_isco88"]
sing2.df$fa_isco88
using2.df$fa_isco88
aa <- using2.df %>%
.[["fa_isco88"]]
recode_from_ISCO88_to_ISEI(ISCO88 = .[["fa_isco88"]], data = .)
aa <- using2.df %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .[["fa_isco88"]], data = .)
View(aa)
using2.df %<>%
mutate(fa_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .[["fa_isco88"]], data = .),
mo_ISEI = recode_from_ISCO88_to_ISEI(ISCO88 = .[["mo_isco88"]], data = .))
using2.df %<>%
recode_from_ISCO88_to_ISEI(ISCO88 = .[["fa_isco88"]], data = .) %>%
rename(fa_ISEI = ISEI) %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .[["fa_isco88"]], data = .) %>%
rename(mo_ISEI = ISEI)
View(using2.df)
load("~/Desktop/workplace/allrun.RData")
## To ISCO88
library(haven)
library(magrittr)
library(tidyverse)
isco_99to08 <- read_dta("/Users/hsuwei/Desktop/gitt/1999-2008_ISCO.dta") %>%
mutate_all(as.integer)
## merging
using2.df <- using.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("fa_longestocc" = "PSFDcode")) %>%
rename(fa_isco88 = isco88)
using2.df <- using2.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("mo_longestocc" = "PSFDcode")) %>%
rename(mo_isco88 = isco88)
library(SocialPosition)
using2.df %<>%
recode_from_ISCO88_to_ISEI(ISCO88 = .[["fa_isco88"]], data = .) %>%
rename(fa_ISEI = ISEI) %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .[["mo_isco88"]], data = .) %>%
rename(mo_ISEI = ISEI)
# Making parents ISEI ------------------------------------------------------
load("~/Desktop/workplace/allrun.RData")
## To ISCO88
library(haven)
library(magrittr)
library(tidyverse)
isco_99to08 <- read_dta("/Users/hsuwei/Desktop/gitt/1999-2008_ISCO.dta") %>%
mutate_all(as.integer)
## merging
using2.df <- using.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("fa_longestocc" = "PSFDcode")) %>%
rename(fa_isco88 = isco88)
using2.df <- using2.df %>%
filter(sample_year < 2009) %>%
left_join(isco_99to08, by = c("mo_longestocc" = "PSFDcode")) %>%
rename(mo_isco88 = isco88)
library(SocialPosition)
using2.df %<>%
recode_from_ISCO88_to_ISEI(ISCO88 = .[["fa_isco88"]], data = .) %>%
rename(fa_ISEI = ISEI) %>%
recode_from_ISCO88_to_ISEI(ISCO88 = .[["mo_isco88"]], data = .) %>%
rename(mo_ISEI = ISEI)
View(using2.df)
funModeling::df_status(using2.df)
setwd("/Users/hsuwei/Desktop/manpower/dataset")
library(readxl)
xx <- read_excel("97_Age")
xx <- read_excel("97_Age.xls")
View(xx)
xx <- read_excel("97_Indusrty.xls")
xx <- read_excel("97_Industry.xls")
View(xx)
xx <- read_excel("97_Worktype.xls")
View(xx)
xx <- read_excel("106_Age.xls")
View(xx)
View(xx)
library(tidyverse)
a <- xx %>%
filter(!is.na(1)) %>%
select(13) %>% # 選取平均月薪
slice()
a <- xx %>%
filter(!is.na(1)) %>%
select(13) #%>% # 選取平均月薪
View(a)
a <- xx %>%
filter(!is.na(1))
View(a)
a <- xx %>%
filter(!is.na(1:10)) %>%
select(13) #%>% # 選取平均月薪
a <- xx %>%
slice(-c(1:10)) %>%
select(13) #%>% # 選取平均月薪
View(a)
a <- xx %>%
slice(-c(1:10))
View(a)
a <- xx %>%
slice(-c(1:10)) %>%
select(1, 15) #%>% # 選取平均月薪
View(a)
slice(2, 5, 10)
slice(c(2, 5, 10))
a <- xx %>%
slice(-c(1:10)) %>%
select(1, 15) %>% # 選取平均月薪
slice(2, 5, 10)
)
a <- xx %>%
slice(-c(1:10)) %>%
select(1, 15) %>% # 選取平均月薪
slice(c(2, 5, 10))
View(a)
a <- xx %>%
slice(-c(1:10))
View(a)
a <- xx %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10))
a <- xx %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10)) %>% # 選取年齡
spread(1, 2)
str_split(x, "_", 1)
x <- "2017_Age.xls"
str_split(x, "_", 1)
str_split(x, "_")
str_split(x, "_", 2)
str_split(x, "_", 3)
str_split(x, "_", 1)
str_split(x, "_", 1) %>%
[[1]]
str_split(x, "_", 1) %>%
.[[1]]
str_split(x, "_") %>%
.[[1]]
str_split(x, "_") %>% class()
a <- str_split(x, "_")
a
a[1]
.[[1,1]]
a[[1]]
a[[1,1]]
a[[1]][1]
b[["year"]] <- str_split(x, "_") %>%
.[[1]][1]
str_split(x, "_") %>%
.[[1]][1]
str_split(x, "_")
library(magrittr)
b[["year"]] <- str_split(x, "_") %>%
.[[1]][1]
b[["year"]] <- str_split(x, "_") %>%
.[1][1]
str_split(x, "_") %>%
.[[1]]
str_split(x, "_") %>%
.[[1]][1]
a <- str_split(x, "_") %>%
.[[1]][1]
a <- str_split(x, "_") %>%
.[[1]]
class(1)
class(a)
a
a <- str_split(x, "_") %>%
.[1]
class(a)
a <- str_split(x, "_") %>%
.[1][1]
a <- str_split(x, "_") %>%
.[1][[1]]
a <- str_split(x, "_") %>%
.[[1]]
a <- str_split(x, "_") %>%
.[[1, 1]]
a
a[1]
a <- str_split(x, "_") %>%
.[[1]][1]
a <- str_split(x, "_") %>%
.[[1]]["1"]
b[["year"]] <- str_split(x, "_") %>%
.[[1]].[1]
b[["year"]] <- str_split(x, "_") %>%
.[[1]] %>%
[1]
b[["year"]] <- str_split(x, "_") %>%
.[[1]] %>%
.[1]
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10)) %>% # 選取年齡
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>%
.[[1]] %>%
.[1]
x <- "2017_Age.xls"
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10)) %>% # 選取年齡
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>%
.[[1]] %>%
.[1]
View(b)
install.packages("tidyverse")
View(b)
datapath <- "/Users/hsuwei/Desktop/manpower/dataset"
setwd(datapath)
list.files(datapath)
setwd(datapath)
library(readxl)
library(tidyverse)
library(magrittr)
list.files(datapath) %>%
str_detect("industry")
list.files(datapath) %>%
str_match("Industry")
list.files(datapath) %>%
str_subset("Industry")
x <- list.files(datapath) %>%
str_subset("Age")
x <- "2017_Age.xls"
x <- list.files(datapath) %>%
str_subset("Age")
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10)) %>% # 選取年齡
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
View(b)
x <- list.files(datapath) %>%
str_subset("Industry")
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10)) %>% # 選取年齡
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
View(b)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15)
View(b)
b <- a %>%
slice(-c(1:10)) %>%
select(1, 16, 15)
x <- list.files(datapath) %>%
str_subset("Industry")
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 3, 9)) %>% # 選取年齡
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
x <- list.files(datapath) %>%
str_subset("Worktype")
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(1, 16, 15)
View(b)
View(a)
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(11, 12, 14, 15, 25,26)) %>% # 選取產業
spread()
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(11, 12, 14, 15, 25,26))
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(11, 12, 14, 15, 25,26)) %>% # 選取產業
spread(1,2)
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(11, 12, 14, 15, 25,26)) %>% # 選取產業
spread(1,2) %>%
select(5, 2, 1, 4, 6, 3) # 調整倆倆相對順序
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
making_age <- function(i){
x <- list.files(datapath) %>% # 選取資料類別
str_subset(i)
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10)) %>% # 選取年齡
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
}
age.df <- making_age("Age")
making_age <- function(i){
x <- list.files(datapath) %>% # 選取資料類別
str_subset(i)
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 5, 10)) %>% # 選取年齡
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
return(b)
}
age.df <- making_age("Age")
View(age.df)
making_indusrty <- function(i){
x <- list.files(datapath) %>%
str_subset(i)
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(2, 3, 9)) %>% # 選取產業
spread(1, 2)
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
return(b)
}
making_worktype <- function(i){
x <- list.files(datapath) %>%
str_subset(i)
a <- read_excel(x)
b <- a %>%
slice(-c(1:10)) %>%
select(16, 15) %>% # 選取平均月薪，用英文當標籤
slice(c(11, 12, 14, 15, 25,26)) %>% # 選取產業
spread(1,2) %>%
select(5, 2, 1, 4, 6, 3) # 調整倆倆相對順序
b[["year"]] <- str_split(x, "_") %>% # 取得年份
.[[1]] %>%
.[1]
return(b)
}
industry.df <- making_indusrty("Industry")
worktype.df <- making_worktype("Worktype")
all <- bind_cols(age.df, industry.df, worktype.df)
View(all)
all <- full_join(age.df, industry.df, by = "year") %>%
full_join(worktype.df, by = "year")
View(all)
all <- full_join(age.df, industry.df, by = "year") %>%
full_join(worktype.df, by = "year") %>%
select(year, everything())
